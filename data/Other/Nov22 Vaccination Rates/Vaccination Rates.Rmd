---
title: "Vaccination Rates V2"
author: "Tori Diamond"
date: "20/05/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(readxl); library(magrittr); library(dplyr); library(tidyr); library(reshape2); library(ggplot2); library(patchwork);library(ggnewscale)
```

## Creating weights for each population type
```{r}
## creating weights df
weights.df <- read_excel("Weights.xlsx", sheet = "HSU&ERP")

#HSU total weights
#using numbers
HSUn.df <- weights.df[-c(2:12),]
HSUn.df <- pivot_longer(HSUn.df, cols = 3:20, names_to = "AgeGroup", values_to = "Weights" ) #changing from rows to column
HSUn.df <- HSUn.df[,c(3,4)] #only showing weights by age-groups

#HSU Māori weights
#using numbers
HSUMn.df <- weights.df[-c(1:2,4:12),]
HSUMn.df <- pivot_longer(HSUMn.df, cols = 3:20, names_to = "AgeGroup", values_to = "Weights" ) #changing from rows to column
HSUMn.df <- HSUMn.df[,c(3,4)] #only showing weights by age-groups

#HSU NonMāori weights
#using numbers
HSUNMn.df <- weights.df[-c(1:4,6:12),]
HSUNMn.df <- pivot_longer(HSUNMn.df, cols = 3:20, names_to = "AgeGroup", values_to = "Weights" ) #changing from rows to column
HSUNMn.df <- HSUNMn.df[,c(3,4)] #only showing weights by age-groups


#ERP total weights
#using numbers
ERPn.df <- weights.df[-c(1:6,8:12),]
ERPn.df <- pivot_longer(ERPn.df, cols = 3:20, names_to = "AgeGroup", values_to = "Weights" ) #changing from rows to column
ERPn.df <- ERPn.df[,c(3,4)] #only showing weights by age-groups

#ERP Māori weights
#using numbers
ERPMn.df <- weights.df[-c(1:8,10:12),]
ERPMn.df <- pivot_longer(ERPMn.df, cols = 3:20, names_to = "AgeGroup", values_to = "Weights" ) #changing from rows to column
ERPMn.df <- ERPMn.df[,c(3,4)] #only showing weights by age-groups

#ERP NonMāori weights
#using numbers
ERPNMn.df <- weights.df[-c(1:10,12),]
ERPNMn.df <- pivot_longer(ERPNMn.df, cols = 3:20, names_to = "AgeGroup", values_to = "Weights" ) #changing from rows to column
ERPNMn.df <- ERPNMn.df[,c(3,4)] #only showing weights by age-groups


```


## Total Fully Vaccinated Rates

```{r}
# Total fully vaccinated
TFVacc_nontotal.df <- read_excel("VaccinationDataR Updated HSU2021.xlsx", sheet = "TotalFullVacc")
TFVacc_nontotal.df<- subset(TFVacc_nontotal.df, Group!="Male" & Group!="Female" & DHB!="Total")

TFVacc_nontotal.df <- pivot_longer(TFVacc_nontotal.df, cols = 4:20, names_to = "AgeGroup", values_to = "Count" ) #changing from rows to column
TFVacc_nontotal.df <- TFVacc_nontotal.df[,c(1,4,5,3)] #rearranging columns to match Daniel's example below


# Using HSU Weights

## Join on the standard population weights (adds in a column called "Weights")
HSU_TFVacc_nontot.df <- left_join(TFVacc_nontotal.df, HSUn.df, by = "AgeGroup")


## Create a dataset for the total of each DHB (all age groups summed), doesn't include all DHB named 'Total'
HSU_TFVacc_tot.df <- HSU_TFVacc_nontot.df %>%
  group_by(DHB) %>%
  summarise(
    AgeGroup = "Total",
    Count = sum(Count), Total = sum(Weights) #sum weights as want to divide by total HSU population for Rate
  )

## Calculate the age-specific rates for each age group in each year
alpha = 0.05 #added this in for 95% CI
HSU_TFVacc_nontot.df <- HSU_TFVacc_nontot.df %>%
  mutate(
    Rate     = Count / Weights, #dividing by age-band population for rate
    RateMult = Rate * 100000,
    Variance = Rate / Weights, ## Var(R) = Count / Weights^2
    
    Rate_KeyfitzLwr = (pmax(0, Rate - qnorm(1 - alpha / 2) * sqrt(Variance), na.rm = TRUE))*100000,
    Rate_KeyfitzUpr = (Rate + qnorm(1 - alpha / 2) * sqrt(Variance))*100000,
    
    Rate_Gamma1Lwr  = (0.5 * qchisq(alpha / 2, 2 * Count) / Weights)*100000,
    Rate_Gamma1Upr  = (0.5 * qchisq(1 - alpha / 2, 2 * (Count + 1)) / Weights)*100000
  )

# Using ERP Weights

## Join on the standard population weights (adds in a column called "Weights")
ERP_TFVacc_nontot.df <- left_join(TFVacc_nontotal.df, ERPn.df, by = "AgeGroup")


## Create a dataset for the total of each DHB (all age groups summed), doesn't include all DHB named 'Total'
ERP_TFVacc_tot.df <- ERP_TFVacc_nontot.df %>%
  group_by(DHB) %>%
  summarise(
    AgeGroup = "Total",
    Count = sum(Count), Total = sum(Weights) #sum weights as want to divide by total HSU population for Rate
  )

## Calculate the age-specific rates for each age group in each year
alpha = 0.05 #added this in for 95% CI
ERP_TFVacc_nontot.df <- ERP_TFVacc_nontot.df %>%
  mutate(
    Rate     = Count / Weights, #dividing by age-band population for rate
    RateMult = Rate * 100000,
    Variance = Rate / Weights, ## Var(R) = Count / Weights^2
    
    Rate_KeyfitzLwr = (pmax(0, Rate - qnorm(1 - alpha / 2) * sqrt(Variance), na.rm = TRUE))*100000,
    Rate_KeyfitzUpr = (Rate + qnorm(1 - alpha / 2) * sqrt(Variance))*100000,
    
    Rate_Gamma1Lwr  = (0.5 * qchisq(alpha / 2, 2 * Count) / Weights)*100000,
    Rate_Gamma1Upr  = (0.5 * qchisq(1 - alpha / 2, 2 * (Count + 1)) / Weights)*100000
  )


View(ERP_TFVacc_nontot.df)
```




## Māori Fully Vaccinated Rates

```{r}
# Total fully vaccinated
MFVacc_nontotal.df <- read_excel("VaccinationDataR Updated HSU2021.xlsx", sheet = "MaoriFullVacc")
MFVacc_nontotal.df<- subset(MFVacc_nontotal.df, Group!="Male" & Group!="Female" & DHB!="Total")

MFVacc_nontotal.df <- pivot_longer(MFVacc_nontotal.df, cols = 4:20, names_to = "AgeGroup", values_to = "Count" ) #changing from rows to column
MFVacc_nontotal.df <- MFVacc_nontotal.df[,c(1,4,5,3)] #rearranging columns to match Daniel's example below


# Using HSU Weights

## Join on the standard population weights (adds in a column called "Weights")
HSU_MFVacc_nontot.df <- left_join(MFVacc_nontotal.df, HSUMn.df, by = "AgeGroup")


## Create a dataset for the total of each DHB (all age groups summed), doesn't include all DHB named 'Total'
HSU_MFVacc_tot.df <- HSU_MFVacc_nontot.df %>%
  group_by(DHB) %>%
  summarise(
    AgeGroup = "Total",
    Count = sum(Count), Total = sum(Weights) #sum weights as want to divide by total HSU population for Rate
  )

## Calculate the age-specific rates for each age group in each DHB
alpha = 0.05 #added this in for 95% CI
HSU_MFVacc_nontot.df <- HSU_MFVacc_nontot.df %>%
  mutate(
    Rate     = Count / Weights, #dividing by age-band population for rate
    RateMult = Rate * 100000,
    Variance = Rate / Weights, ## Var(R) = Count / Weights^2
    
    Rate_KeyfitzLwr = (pmax(0, Rate - qnorm(1 - alpha / 2) * sqrt(Variance), na.rm = TRUE))*100000,
    Rate_KeyfitzUpr = (Rate + qnorm(1 - alpha / 2) * sqrt(Variance))*100000,
    
    Rate_Gamma1Lwr  = (0.5 * qchisq(alpha / 2, 2 * Count) / Weights)*100000,
    Rate_Gamma1Upr  = (0.5 * qchisq(1 - alpha / 2, 2 * (Count + 1)) / Weights)*100000
  )

# Using ERP Weights

## Join on the standard population weights (adds in a column called "Weights")
ERP_MFVacc_nontot.df <- left_join(MFVacc_nontotal.df, ERPMn.df, by = "AgeGroup")


## Create a dataset for the total of each DHB (all age groups summed), doesn't include all DHB named 'Total'
ERP_MFVacc_tot.df <- ERP_MFVacc_nontot.df %>%
  group_by(DHB) %>%
  summarise(
    AgeGroup = "Total",
    Count = sum(Count), Total = sum(Weights) #sum weights as want to divide by total HSU population for Rate
  )

## Calculate the age-specific rates for each age group in each DHB
alpha = 0.05 #added this in for 95% CI
ERP_MFVacc_nontot.df <- ERP_MFVacc_nontot.df %>%
  mutate(
    Rate     = Count / Weights, #dividing by age-band population for rate
    RateMult = Rate * 100000,
    Variance = Rate / Weights, ## Var(R) = Count / Weights^2
    
    Rate_KeyfitzLwr = (pmax(0, Rate - qnorm(1 - alpha / 2) * sqrt(Variance), na.rm = TRUE))*100000,
    Rate_KeyfitzUpr = (Rate + qnorm(1 - alpha / 2) * sqrt(Variance))*100000,
    
    Rate_Gamma1Lwr  = (0.5 * qchisq(alpha / 2, 2 * Count) / Weights)*100000,
    Rate_Gamma1Upr  = (0.5 * qchisq(1 - alpha / 2, 2 * (Count + 1)) / Weights)*100000
  )

```

## Non-Māori Fully Vaccinated Rates

```{r}
# Total fully vaccinated
NMFVacc_nontotal.df <- read_excel("VaccinationDataR Updated HSU2021.xlsx", sheet = "NonMaoriFullVacc")
NMFVacc_nontotal.df<- subset(NMFVacc_nontotal.df, Group!="Male" & Group!="Female" & DHB!="Total")

NMFVacc_nontotal.df <- pivot_longer(NMFVacc_nontotal.df, cols = 4:20, names_to = "AgeGroup", values_to = "Count" ) #changing from rows to column
NMFVacc_nontotal.df <- NMFVacc_nontotal.df[,c(1,4,5,3)] #rearranging columns to match Daniel's example below


# Using HSU Weights

## Join on the standard population weights (adds in a column called "Weights")
HSU_NMFVacc_nontot.df <- left_join(NMFVacc_nontotal.df, HSUNMn.df, by = "AgeGroup")


## Create a dataset for the total of each DHB (all age groups summed), doesn't include all DHB named 'Total'
HSU_NMFVacc_tot.df <- HSU_NMFVacc_nontot.df %>%
  group_by(DHB) %>%
  summarise(
    AgeGroup = "Total",
    Count = sum(Count), Total = sum(Weights) #sum weights as want to divide by total HSU population for Rate
  )

## Calculate the age-specific rates for each age group in each DHB
alpha = 0.05 #added this in for 95% CI
HSU_NMFVacc_nontot.df <- HSU_NMFVacc_nontot.df %>%
  mutate(
    Rate     = Count / Weights, #dividing by age-band population for rate
    RateMult = Rate * 100000,
    Variance = Rate / Weights, ## Var(R) = Count / Weights^2
    
    Rate_KeyfitzLwr = (pmax(0, Rate - qnorm(1 - alpha / 2) * sqrt(Variance), na.rm = TRUE))*100000,
    Rate_KeyfitzUpr = (Rate + qnorm(1 - alpha / 2) * sqrt(Variance))*100000,
    
    Rate_Gamma1Lwr  = (0.5 * qchisq(alpha / 2, 2 * Count) / Weights)*100000,
    Rate_Gamma1Upr  = (0.5 * qchisq(1 - alpha / 2, 2 * (Count + 1)) / Weights)*100000
  )

# Using ERP Weights

## Join on the standard population weights (adds in a column called "Weights")
ERP_NMFVacc_nontot.df <- left_join(NMFVacc_nontotal.df, ERPNMn.df, by = "AgeGroup")


## Create a dataset for the total of each DHB (all age groups summed), doesn't include all DHB named 'Total'
ERP_NMFVacc_tot.df <- ERP_NMFVacc_nontot.df %>%
  group_by(DHB) %>%
  summarise(
    AgeGroup = "Total",
    Count = sum(Count), Total = sum(Weights) #sum weights as want to divide by total HSU population for Rate
  )

## Calculate the age-specific rates for each age group in each DHB
alpha = 0.05 #added this in for 95% CI
ERP_NMFVacc_nontot.df <- ERP_NMFVacc_nontot.df %>%
  mutate(
    Rate     = Count / Weights, #dividing by age-band population for rate
    RateMult = Rate * 100000,
    Variance = Rate / Weights, ## Var(R) = Count / Weights^2
    
    Rate_KeyfitzLwr = (pmax(0, Rate - qnorm(1 - alpha / 2) * sqrt(Variance), na.rm = TRUE))*100000,
    Rate_KeyfitzUpr = (Rate + qnorm(1 - alpha / 2) * sqrt(Variance))*100000,
    
    Rate_Gamma1Lwr  = (0.5 * qchisq(alpha / 2, 2 * Count) / Weights)*100000,
    Rate_Gamma1Upr  = (0.5 * qchisq(1 - alpha / 2, 2 * (Count + 1)) / Weights)*100000
  )

```

## Rates of DHB Total by Age groups (Total pop)
```{r}
# Total fully vaccinated
TFVacc_DHBtotal.df <- read_excel("VaccinationDataR Updated HSU2021.xlsx", sheet = "TotalFullVacc")
TFVacc_DHBtotal.df<- subset(TFVacc_DHBtotal.df, Group!="Male" & Group!="Female" & DHB=="Total")

TFVacc_DHBtotal.df <- pivot_longer(TFVacc_DHBtotal.df, cols = 3, values_to = "Total" ) #changing from rows to column
TFVacc_DHBtotal.df <- pivot_longer(TFVacc_DHBtotal.df, cols = 3:19, names_to = "AgeGroup", values_to = "Count" ) #changing from rows to column

TFVacc_DHBtotal.df <- TFVacc_DHBtotal.df[,c(1,5,6,4)] #rearranging columns to match Daniel's example below



# Using HSU Weights


HSU_TFVacc_DHBtot.df <- left_join(TFVacc_DHBtotal.df, HSUn.df, by = "AgeGroup")


## Calculate the age-specific rates for each age group for total regions
alpha = 0.05 #added this in for 95% CI
HSU_TFVacc_DHBtot.df <- HSU_TFVacc_DHBtot.df %>%
  mutate(
    Rate     = Count / Weights,
    RateMult = Rate * 100000,
    Variance = Rate / Weights, ## Var(R) = Count / Total^2
    
    Rate_KeyfitzLwr = (pmax(0, Rate - qnorm(1 - alpha / 2) * sqrt(Variance), na.rm = TRUE))*100000,
    Rate_KeyfitzUpr = (Rate + qnorm(1 - alpha / 2) * sqrt(Variance))*100000,
    
    Rate_Gamma1Lwr  = (0.5 * qchisq(alpha / 2, 2 * Count) / Weights)*100000,
    Rate_Gamma1Upr  = (0.5 * qchisq(1 - alpha / 2, 2 * (Count + 1)) / Weights)*100000
  )


# Using ERP Weights


ERP_TFVacc_DHBtot.df <- left_join(TFVacc_DHBtotal.df, ERPn.df, by = "AgeGroup")


## Calculate the age-specific rates for each age group for total regions
alpha = 0.05 #added this in for 95% CI
ERP_TFVacc_DHBtot.df <- ERP_TFVacc_DHBtot.df %>%
  mutate(
    Rate     = Count / Weights,
    RateMult = Rate * 100000,
    Variance = Rate / Weights, ## Var(R) = Count / Total^2
    
    Rate_KeyfitzLwr = (pmax(0, Rate - qnorm(1 - alpha / 2) * sqrt(Variance), na.rm = TRUE))*100000,
    Rate_KeyfitzUpr = (Rate + qnorm(1 - alpha / 2) * sqrt(Variance))*100000,
    
    Rate_Gamma1Lwr  = (0.5 * qchisq(alpha / 2, 2 * Count) / Weights)*100000,
    Rate_Gamma1Upr  = (0.5 * qchisq(1 - alpha / 2, 2 * (Count + 1)) / Weights)*100000
  )

```


## Rates of DHB Total by Age groups (Māori pop)
```{r}
# Total fully vaccinated
MFVacc_DHBtotal.df <- read_excel("VaccinationDataR Updated HSU2021.xlsx", sheet = "MaoriFullVacc")
MFVacc_DHBtotal.df<- subset(MFVacc_DHBtotal.df, Group!="Male" & Group!="Female" & DHB=="Total")

MFVacc_DHBtotal.df <- pivot_longer(MFVacc_DHBtotal.df, cols = 3, values_to = "Total" ) #changing from rows to column
MFVacc_DHBtotal.df <- pivot_longer(MFVacc_DHBtotal.df, cols = 3:19, names_to = "AgeGroup", values_to = "Count" ) #changing from rows to column

MFVacc_DHBtotal.df <- MFVacc_DHBtotal.df[,c(1,5,6,4)] #rearranging columns to match Daniel's example below



# Using HSU Weights


HSU_MFVacc_DHBtot.df <- left_join(MFVacc_DHBtotal.df, HSUMn.df, by = "AgeGroup")


## Calculate the age-specific rates for each age group for total regions
alpha = 0.05 #added this in for 95% CI
HSU_MFVacc_DHBtot.df <- HSU_MFVacc_DHBtot.df %>%
  mutate(
    Rate     = Count / Weights,
    RateMult = Rate * 100000,
    Variance = Rate / Weights, ## Var(R) = Count / Total^2
    
    Rate_KeyfitzLwr = (pmax(0, Rate - qnorm(1 - alpha / 2) * sqrt(Variance), na.rm = TRUE))*100000,
    Rate_KeyfitzUpr = (Rate + qnorm(1 - alpha / 2) * sqrt(Variance))*100000,
    
    Rate_Gamma1Lwr  = (0.5 * qchisq(alpha / 2, 2 * Count) / Weights)*100000,
    Rate_Gamma1Upr  = (0.5 * qchisq(1 - alpha / 2, 2 * (Count + 1)) / Weights)*100000
  )


# Using ERP Weights


ERP_MFVacc_DHBtot.df <- left_join(MFVacc_DHBtotal.df, ERPMn.df, by = "AgeGroup")


## Calculate the age-specific rates for each age group for total regions
alpha = 0.05 #added this in for 95% CI
ERP_MFVacc_DHBtot.df <- ERP_MFVacc_DHBtot.df %>%
  mutate(
    Rate     = Count / Weights,
    RateMult = Rate * 100000,
    Variance = Rate / Weights, ## Var(R) = Count / Total^2
    
    Rate_KeyfitzLwr = (pmax(0, Rate - qnorm(1 - alpha / 2) * sqrt(Variance), na.rm = TRUE))*100000,
    Rate_KeyfitzUpr = (Rate + qnorm(1 - alpha / 2) * sqrt(Variance))*100000,
    
    Rate_Gamma1Lwr  = (0.5 * qchisq(alpha / 2, 2 * Count) / Weights)*100000,
    Rate_Gamma1Upr  = (0.5 * qchisq(1 - alpha / 2, 2 * (Count + 1)) / Weights)*100000
  )

```


## Rates of DHB Total by Age groups (Non-Māori pop)
```{r}
# Total fully vaccinated
NMFVacc_DHBtotal.df <- read_excel("VaccinationDataR Updated HSU2021.xlsx", sheet = "NonMaoriFullVacc")
NMFVacc_DHBtotal.df<- subset(NMFVacc_DHBtotal.df, Group!="Male" & Group!="Female" & DHB=="Total")

NMFVacc_DHBtotal.df <- pivot_longer(NMFVacc_DHBtotal.df, cols = 3, values_to = "Total" ) #changing from rows to column
NMFVacc_DHBtotal.df <- pivot_longer(NMFVacc_DHBtotal.df, cols = 3:19, names_to = "AgeGroup", values_to = "Count" ) #changing from rows to column

NMFVacc_DHBtotal.df <- NMFVacc_DHBtotal.df[,c(1,5,6,4)] #rearranging columns to match Daniel's example below



# Using HSU Weights


HSU_NMFVacc_DHBtot.df <- left_join(NMFVacc_DHBtotal.df, HSUNMn.df, by = "AgeGroup")


## Calculate the age-specific rates for each age group for total regions
alpha = 0.05 #added this in for 95% CI
HSU_NMFVacc_DHBtot.df <- HSU_NMFVacc_DHBtot.df %>%
  mutate(
    Rate     = Count / Weights,
    RateMult = Rate * 100000,
    Variance = Rate / Weights, ## Var(R) = Count / Total^2
    
    Rate_KeyfitzLwr = (pmax(0, Rate - qnorm(1 - alpha / 2) * sqrt(Variance), na.rm = TRUE))*100000,
    Rate_KeyfitzUpr = (Rate + qnorm(1 - alpha / 2) * sqrt(Variance))*100000,
    
    Rate_Gamma1Lwr  = (0.5 * qchisq(alpha / 2, 2 * Count) / Weights)*100000,
    Rate_Gamma1Upr  = (0.5 * qchisq(1 - alpha / 2, 2 * (Count + 1)) / Weights)*100000
  )


# Using ERP Weights


ERP_NMFVacc_DHBtot.df <- left_join(NMFVacc_DHBtotal.df, ERPNMn.df, by = "AgeGroup")


## Calculate the age-specific rates for each age group for total regions
alpha = 0.05 #added this in for 95% CI
ERP_NMFVacc_DHBtot.df <- ERP_NMFVacc_DHBtot.df %>%
  mutate(
    Rate     = Count / Weights,
    RateMult = Rate * 100000,
    Variance = Rate / Weights, ## Var(R) = Count / Total^2
    
    Rate_KeyfitzLwr = (pmax(0, Rate - qnorm(1 - alpha / 2) * sqrt(Variance), na.rm = TRUE))*100000,
    Rate_KeyfitzUpr = (Rate + qnorm(1 - alpha / 2) * sqrt(Variance))*100000,
    
    Rate_Gamma1Lwr  = (0.5 * qchisq(alpha / 2, 2 * Count) / Weights)*100000,
    Rate_Gamma1Upr  = (0.5 * qchisq(1 - alpha / 2, 2 * (Count + 1)) / Weights)*100000
  )

```












## Plots


## Total Fully Vaccinated rates using HSU and ERP, by national total (DHB=total)
```{r, fig.height= 10, fig.width= 10}

level_order <- c("5-11","12-17", "18-24", "25-29", "30-34", "35-39","40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90+")

# use this to create HSU and ERP on one plot

HSUvsERP_TFVacc_DHB.df <- rbind(
  data.frame(HSU_TFVacc_DHBtot.df, population="HSU"),
  data.frame(ERP_TFVacc_DHBtot.df, population="ERP")
)

ggplot(subset(HSUvsERP_TFVacc_DHB.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) + 
  geom_col(position = position_dodge()) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr),position = position_dodge(width = 0.85), width = 0.5) +
  #guides(fill = 'none') +
  plot_annotation(title = "Total Fully Vaccinated Rates by Age Groups") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

```


```{r, eval=FALSE}


#pdf(file="Total Fully Vaccinated Rates by Age Group.pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_TFVacc_DHB.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) + 
  geom_col(position = position_dodge()) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr),position = position_dodge(width = 0.85), width = 0.5) +
  #guides(fill = 'none') +
  plot_annotation(title = "Total Fully Vaccinated Rates by Age Groups") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()
```

## Māori Fully Vaccinated rates using HSU and ERP, by national total (DHB=total)
```{r, fig.height= 10, fig.width= 10}

level_order <- c("5-11","12-17", "18-24", "25-29", "30-34", "35-39","40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90+")

# use this to create HSU and ERP on one plot

HSUvsERP_MFVacc_DHB.df <- rbind(
  data.frame(HSU_MFVacc_DHBtot.df, population="HSU"),
  data.frame(ERP_MFVacc_DHBtot.df, population="ERP")
)


ggplot(subset(HSUvsERP_MFVacc_DHB.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) + 
  geom_col(position = position_dodge()) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr),position = position_dodge(width = 0.85), width = 0.5) +
  #guides(fill = 'none') +
  plot_annotation(title = "Maori Fully Vaccinated Rates by Age Group") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

```


```{r, eval=FALSE}

#pdf(file="Maori Fully Vaccinated Rates by Age Group.pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_MFVacc_DHB.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) + 
  geom_col(position = position_dodge()) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr),position = position_dodge(width = 0.85), width = 0.5) +
  #guides(fill = 'none') +
  plot_annotation(title = "Maori Fully Vaccinated Rates by Age Group") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()
```



## Rate-Ratios


## Total Vaccinations RR DHB total by agegroups

## code for setting HSU as baseline for Total Vaccinations

```{r}

HSU_TFVacc_baseline.total <- HSU_TFVacc_DHBtot.df
ERP_TFVacc_population.total <- ERP_TFVacc_DHBtot.df

## Rename variables so we can use them after joining to the other dataset (otherwise we get Rate.x and Rate.y which is a bit confusing).
HSU_TFVacc_baseline.total <- HSU_TFVacc_baseline.total %>%
  dplyr::rename(
    RateBaseline     = Rate,
    VarianceBaseline = Variance,
    #W_meanBaseline   = W_mean,
    RateBaselineLwr = Rate_KeyfitzLwr,
    RateBaselineUpr = Rate_KeyfitzUpr
  ) %>%
  dplyr::mutate(
    RRVarBaseline = ((Total - Count) / Total) / Count,
    ARVarBaseline = VarianceBaseline
  ) %>%
  dplyr::select(DHB, AgeGroup, RateBaseline, RRVarBaseline, ARVarBaseline, VarianceBaseline, RateBaselineLwr, RateBaselineUpr)


HSU_TFVacc_baseline.other <- HSU_TFVacc_nontot.df
ERP_TFVacc_population.other <- ERP_TFVacc_nontot.df

HSU_TFVacc_baseline.other$AgeGroup <- as.character(HSU_TFVacc_baseline.other$AgeGroup)
ERP_TFVacc_population.other$AgeGroup <- as.character(ERP_TFVacc_population.other$AgeGroup)




HSU_TFVacc_baseline.other <- HSU_TFVacc_baseline.other %>%
  dplyr::mutate(
    RateBaseline = Rate,
    RRVarBaseline = (1 / Count - 1 / Total),
    CountBaseline = Count,
    TotalBaseline = Total,

    RateBaselineLwr = Rate_KeyfitzLwr,
    RateBaselineUpr = Rate_KeyfitzUpr
  ) %>%
  dplyr::select(DHB, AgeGroup, RateBaseline, RRVarBaseline, CountBaseline, TotalBaseline, RateBaselineLwr, RateBaselineUpr)

## Join the baseline and other population datasets, calculating the RR and asssociated CI
ERP_TFVacc_population.other <-ERP_TFVacc_population.other %>%
  dplyr::left_join(HSU_TFVacc_baseline.other, by = c("DHB", "AgeGroup")) %>%
  dplyr::mutate(
    RelativeRisk = Rate / RateBaseline,
    AttributableRisk = Rate - RateBaseline,
    # RRVar = (1 / Count) * ((Total - Count) / Total),
    RRVar = (1 / Count - 1 / Total),
    RelativeRiskLwr = exp(log(RelativeRisk) - 1.96 * sqrt(RRVar + RRVarBaseline)),
    RelativeRiskUpr = exp(log(RelativeRisk) + 1.96 * sqrt(RRVar + RRVarBaseline)),
    # ARVar = Rate * (1 - Rate) * (1 / Total + 1 / TotalBaseline),
    ARVar = (Count + CountBaseline) / (Total + TotalBaseline) * (1 - (Count + CountBaseline) / (Total + TotalBaseline)) * (1 / Total + 1 / TotalBaseline),
    AttributableRiskLwr = AttributableRisk - 1.96 * sqrt(ARVar),
    AttributableRiskUpr = AttributableRisk + 1.96 * sqrt(ARVar)
  ) %>%
  dplyr::select(-RRVarBaseline, -RRVar, -ARVar, -CountBaseline, -TotalBaseline, -RateBaselineLwr, -RateBaselineUpr)

TFVacc_DHBpopulation.df <- ERP_TFVacc_population.total %>%
  dplyr::left_join(HSU_TFVacc_baseline.total, by = c("DHB", "AgeGroup")) %>%
  dplyr::mutate(
    RelativeRisk    = Rate / RateBaseline,
    RRVar           = ((Total - Count) / Total) / Count,
    RelativeRiskLwr = exp(log(RelativeRisk) - 1.96 * sqrt(RRVar + RRVarBaseline)),
    RelativeRiskUpr = exp(log(RelativeRisk) + 1.96 * sqrt(RRVar + RRVarBaseline)),

    AttributableRisk    = Rate - RateBaseline,
    ARVar               = Variance,
    AttributableRiskLwr = AttributableRisk - 1.96 * sqrt(ARVar + ARVarBaseline),
    AttributableRiskUpr = AttributableRisk + 1.96 * sqrt(ARVar + ARVarBaseline)
  ) %>%
  dplyr::select(-RRVarBaseline, -RRVar, -ARVarBaseline, -ARVar) %>%
  dplyr::bind_rows(ERP_TFVacc_population.other)


```

## Rate ratio for Fully Vaccinated Rates by grouped DHB with 95% CI's
```{r, fig.height= 10, fig.width= 10}

ggplot(subset(TFVacc_DHBpopulation.df, DHB == "Total"), aes(x=factor(AgeGroup, level= level_order), y = RelativeRisk, fill=RelativeRisk))+
  geom_col(fill = "Steel Blue 2")+
  geom_errorbar(aes(min=RelativeRiskLwr, ymax=RelativeRiskUpr), width=0.5) +
  plot_annotation(title = "Total Fully Vaccinated Rate Ratio by Age Group (HSU as baseline)") +
  labs(y= "Rate Ratio",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

```


```{r, eval=FALSE}


#pdf(file="Total Fully Vaccinated Rate Ratio by Age Group (HSU as baseline).pdf", width = 10, height = 10)


ggplot(subset(TFVacc_DHBpopulation.df, DHB == "Total"), aes(x=factor(AgeGroup, level= level_order), y = RelativeRisk,fill=RelativeRisk))+
  geom_col(fill = "Steel Blue 2")+
  geom_errorbar(aes(min=RelativeRiskLwr, ymax=RelativeRiskUpr), width=0.5) +
  plot_annotation(title = "Total Fully Vaccinated Rate Ratio by Age Group (HSU as baseline)") +
  labs(y= "Rate Ratio",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))


dev.off()
```



## Total Māori Vaccinations RR

## code for setting ERP as baseline for Māori Vaccinations

```{r}

HSU_MFVacc_baseline.total <- HSU_MFVacc_DHBtot.df
ERP_MFVacc_population.total <- ERP_MFVacc_DHBtot.df

## Rename variables so we can use them after joining to the other dataset (otherwise we get Rate.x and Rate.y which is a bit confusing).
HSU_MFVacc_baseline.total <- HSU_MFVacc_baseline.total %>%
  dplyr::rename(
    RateBaseline     = Rate,
    VarianceBaseline = Variance,
    #W_meanBaseline   = W_mean,
    RateBaselineLwr = Rate_KeyfitzLwr,
    RateBaselineUpr = Rate_KeyfitzUpr
  ) %>%
  dplyr::mutate(
    RRVarBaseline = ((Total - Count) / Total) / Count,
    ARVarBaseline = VarianceBaseline
  ) %>%
  dplyr::select(DHB, AgeGroup, RateBaseline, RRVarBaseline, ARVarBaseline, VarianceBaseline, RateBaselineLwr, RateBaselineUpr)


HSU_MFVacc_baseline.other <- HSU_MFVacc_nontot.df
ERP_MFVacc_population.other <- ERP_MFVacc_nontot.df

HSU_MFVacc_baseline.other$AgeGroup <- as.character(HSU_MFVacc_baseline.other$AgeGroup)
ERP_MFVacc_population.other$AgeGroup <- as.character(ERP_MFVacc_population.other$AgeGroup)


HSU_MFVacc_baseline.other <- HSU_MFVacc_baseline.other %>%
  dplyr::mutate(
    RateBaseline = Rate,
    RRVarBaseline = (1 / Count - 1 / Total),
    CountBaseline = Count,
    TotalBaseline = Total,

    RateBaselineLwr = Rate_KeyfitzLwr,
    RateBaselineUpr = Rate_KeyfitzUpr
  ) %>%
  dplyr::select(DHB, AgeGroup, RateBaseline, RRVarBaseline, CountBaseline, TotalBaseline, RateBaselineLwr, RateBaselineUpr)

## Join the baseline and other population datasets, calculating the RR and asssociated CI
ERP_MFVacc_population.other <-ERP_MFVacc_population.other %>%
  dplyr::left_join(HSU_MFVacc_baseline.other, by = c("DHB", "AgeGroup")) %>%
  dplyr::mutate(
    RelativeRisk = Rate / RateBaseline,
    AttributableRisk = Rate - RateBaseline,
    # RRVar = (1 / Count) * ((Total - Count) / Total),
    RRVar = (1 / Count - 1 / Total),
    RelativeRiskLwr = exp(log(RelativeRisk) - 1.96 * sqrt(RRVar + RRVarBaseline)),
    RelativeRiskUpr = exp(log(RelativeRisk) + 1.96 * sqrt(RRVar + RRVarBaseline)),
    # ARVar = Rate * (1 - Rate) * (1 / Total + 1 / TotalBaseline),
    ARVar = (Count + CountBaseline) / (Total + TotalBaseline) * (1 - (Count + CountBaseline) / (Total + TotalBaseline)) * (1 / Total + 1 / TotalBaseline),
    AttributableRiskLwr = AttributableRisk - 1.96 * sqrt(ARVar),
    AttributableRiskUpr = AttributableRisk + 1.96 * sqrt(ARVar)
  ) %>%
  dplyr::select(-RRVarBaseline, -RRVar, -ARVar, -CountBaseline, -TotalBaseline, -RateBaselineLwr, -RateBaselineUpr)

MFVacc_DHBpopulation.df <- ERP_MFVacc_population.total %>%
  dplyr::left_join(HSU_MFVacc_baseline.total, by = c("DHB", "AgeGroup")) %>%
  dplyr::mutate(
    RelativeRisk    = Rate / RateBaseline,
    RRVar           = ((Total - Count) / Total) / Count,
    RelativeRiskLwr = exp(log(RelativeRisk) - 1.96 * sqrt(RRVar + RRVarBaseline)),
    RelativeRiskUpr = exp(log(RelativeRisk) + 1.96 * sqrt(RRVar + RRVarBaseline)),

    AttributableRisk    = Rate - RateBaseline,
    ARVar               = Variance,
    AttributableRiskLwr = AttributableRisk - 1.96 * sqrt(ARVar + ARVarBaseline),
    AttributableRiskUpr = AttributableRisk + 1.96 * sqrt(ARVar + ARVarBaseline)
  ) %>%
  dplyr::select(-RRVarBaseline, -RRVar, -ARVarBaseline, -ARVar) %>%
  dplyr::bind_rows(ERP_MFVacc_population.other)


```

## Rate ratio for Fully Vaccinated Rates by grouped DHB with 95% CI's
```{r, fig.height= 10, fig.width= 10}

ggplot(subset(MFVacc_DHBpopulation.df, DHB == "Total"), aes(x=factor(AgeGroup, level= level_order), y = RelativeRisk,fill=RelativeRisk))+
  geom_col(fill = "Steel Blue 2")+
  geom_errorbar(aes(min=RelativeRiskLwr, ymax=RelativeRiskUpr), width=0.5) +
  plot_annotation(title = "Maori Fully Vaccinated Rate Ratio by Age Group (HSU as baseline)") +
  labs(y= "Rate Ratio",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

```


```{r, eval=FALSE}

#pdf(file="Maori Fully Vaccinated Rate Ratio by Age Group (HSU as baseline).pdf", width = 10, height = 10)

ggplot(subset(MFVacc_DHBpopulation.df, DHB == "Total"), aes(x=factor(AgeGroup, level= level_order), y = RelativeRisk, fill=RelativeRisk))+
  geom_col(fill = "Steel Blue 2")+
  geom_errorbar(aes(min=RelativeRiskLwr, ymax=RelativeRiskUpr), width=0.5) +
  plot_annotation(title = "Maori Fully Vaccinated Rate Ratio by Age Group (HSU as baseline)") +
  labs(y= "Rate Ratio",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()

```



## Total Non-Māori Vaccinations RR

## code for setting ERP as baseline for Non-Māori Vaccinations

```{r}

HSU_NMFVacc_baseline.total <- HSU_NMFVacc_DHBtot.df
ERP_NMFVacc_population.total <- ERP_NMFVacc_DHBtot.df

## Rename variables so we can use them after joining to the other dataset (otherwise we get Rate.x and Rate.y which is a bit confusing).
HSU_NMFVacc_baseline.total <- HSU_NMFVacc_baseline.total %>%
  dplyr::rename(
    RateBaseline     = Rate,
    VarianceBaseline = Variance,
    #W_meanBaseline   = W_mean,
    RateBaselineLwr = Rate_KeyfitzLwr,
    RateBaselineUpr = Rate_KeyfitzUpr
  ) %>%
  dplyr::mutate(
    RRVarBaseline = ((Total - Count) / Total) / Count,
    ARVarBaseline = VarianceBaseline
  ) %>%
  dplyr::select(DHB, AgeGroup, RateBaseline, RRVarBaseline, ARVarBaseline, VarianceBaseline, RateBaselineLwr, RateBaselineUpr)


HSU_NMFVacc_baseline.other <- HSU_NMFVacc_nontot.df
ERP_NMFVacc_population.other <- ERP_NMFVacc_nontot.df

HSU_NMFVacc_baseline.other$AgeGroup <- as.character(HSU_NMFVacc_baseline.other$AgeGroup)
ERP_NMFVacc_population.other$AgeGroup <- as.character(ERP_NMFVacc_population.other$AgeGroup)

HSU_NMFVacc_baseline.other <- HSU_NMFVacc_baseline.other %>%
  dplyr::mutate(
    RateBaseline = Rate,
    RRVarBaseline = (1 / Count - 1 / Total),
    CountBaseline = Count,
    TotalBaseline = Total,

    RateBaselineLwr = Rate_KeyfitzLwr,
    RateBaselineUpr = Rate_KeyfitzUpr
  ) %>%
  dplyr::select(DHB, AgeGroup, RateBaseline, RRVarBaseline, CountBaseline, TotalBaseline, RateBaselineLwr, RateBaselineUpr)

## Join the baseline and other population datasets, calculating the RR and asssociated CI
ERP_NMFVacc_population.other <-ERP_NMFVacc_population.other %>%
  dplyr::left_join(HSU_NMFVacc_baseline.other, by = c("DHB", "AgeGroup")) %>%
  dplyr::mutate(
    RelativeRisk = Rate / RateBaseline,
    AttributableRisk = Rate - RateBaseline,
    # RRVar = (1 / Count) * ((Total - Count) / Total),
    RRVar = (1 / Count - 1 / Total),
    RelativeRiskLwr = exp(log(RelativeRisk) - 1.96 * sqrt(RRVar + RRVarBaseline)),
    RelativeRiskUpr = exp(log(RelativeRisk) + 1.96 * sqrt(RRVar + RRVarBaseline)),
    # ARVar = Rate * (1 - Rate) * (1 / Total + 1 / TotalBaseline),
    ARVar = (Count + CountBaseline) / (Total + TotalBaseline) * (1 - (Count + CountBaseline) / (Total + TotalBaseline)) * (1 / Total + 1 / TotalBaseline),
    AttributableRiskLwr = AttributableRisk - 1.96 * sqrt(ARVar),
    AttributableRiskUpr = AttributableRisk + 1.96 * sqrt(ARVar)
  ) %>%
  dplyr::select(-RRVarBaseline, -RRVar, -ARVar, -CountBaseline, -TotalBaseline, -RateBaselineLwr, -RateBaselineUpr)

NMFVacc_DHBpopulation.df <- ERP_NMFVacc_population.total %>%
  dplyr::left_join(HSU_NMFVacc_baseline.total, by = c("DHB", "AgeGroup")) %>%
  dplyr::mutate(
    RelativeRisk    = Rate / RateBaseline,
    RRVar           = ((Total - Count) / Total) / Count,
    RelativeRiskLwr = exp(log(RelativeRisk) - 1.96 * sqrt(RRVar + RRVarBaseline)),
    RelativeRiskUpr = exp(log(RelativeRisk) + 1.96 * sqrt(RRVar + RRVarBaseline)),

    AttributableRisk    = Rate - RateBaseline,
    ARVar               = Variance,
    AttributableRiskLwr = AttributableRisk - 1.96 * sqrt(ARVar + ARVarBaseline),
    AttributableRiskUpr = AttributableRisk + 1.96 * sqrt(ARVar + ARVarBaseline)
  ) %>%
  dplyr::select(-RRVarBaseline, -RRVar, -ARVarBaseline, -ARVar) %>%
  dplyr::bind_rows(ERP_NMFVacc_population.other)


```

# Rate ratio for Fully Vaccinated Rates by grouped DHB with 95% CI's
```{r, fig.height= 10, fig.width= 10} 

ggplot(subset(NMFVacc_DHBpopulation.df, DHB == "Total"), aes(x=factor(AgeGroup, level= level_order), y = RelativeRisk, fill=RelativeRisk))+
  geom_col(fill = "Steel Blue 2")+
  geom_errorbar(aes(min=RelativeRiskLwr, ymax=RelativeRiskUpr), width=0.5)+
  plot_annotation(title = "Non-Maori Fully Vaccinated Rate Ratio by Age Group (HSU as baseline)") +
  labs(y= "Rate Ratio",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

```

```{r, eval=FALSE}



#pdf(file="Non-Maori Fully Vaccinated Rate Ratio by Age Group (HSU as baseline).pdf", width = 10, height = 10)

ggplot(subset(NMFVacc_DHBpopulation.df, DHB == "Total"), aes(x=factor(AgeGroup, level= level_order), y = RelativeRisk, fill=RelativeRisk))+
  geom_col(fill = "Steel Blue 2")+
  geom_errorbar(aes(min=RelativeRiskLwr, ymax=RelativeRiskUpr), width=0.5)+
  plot_annotation(title = "Non-Maori Fully Vaccinated Rate Ratio by Age Group (HSU as baseline)") +
  labs(y= "Rate Ratio",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()
```

## Rate ratio for Fully Vaccinated Rates by national total (DHB=total) with 95% CI's


```{r, fig.height= 10, fig.width= 10}
TVacc_RR_DHB.plot <-ggplot(subset(TFVacc_DHBpopulation.df, DHB == "Total"), aes(x=factor(AgeGroup, level= level_order), y = RelativeRisk))+
  geom_col()+
  geom_errorbar(aes(min=RelativeRiskLwr, ymax=RelativeRiskUpr), width=0.5)


MVacc_RR_DHB.plot <-ggplot(subset(MFVacc_DHBpopulation.df, DHB == "Total"), aes(x=factor(AgeGroup, level= level_order), y = RelativeRisk))+
  geom_col()+
  geom_errorbar(aes(min=RelativeRiskLwr, ymax=RelativeRiskUpr), width=0.5)



NMVacc_RR_DHB.plot <-ggplot(subset(NMFVacc_DHBpopulation.df, DHB == "Total"), aes(x=factor(AgeGroup, level= level_order), y = RelativeRisk))+
  geom_col()+
  geom_errorbar(aes(min=RelativeRiskLwr, ymax=RelativeRiskUpr), width=0.5)


FVaccRR_DHBtot.plot <- (TVacc_RR_DHB.plot / MVacc_RR_DHB.plot / NMVacc_RR_DHB.plot) +
  plot_annotation(title = "Fully Vaccinated Rate Ratios") &
  theme(plot.title = element_text(hjust = 0.5))



# fixing the y axes to keep consistent scale 
p_ranges_y <- c(ggplot_build(FVaccRR_DHBtot.plot[[1]])$layout$panel_scales_y[[1]]$range$range,
                ggplot_build(FVaccRR_DHBtot.plot[[2]])$layout$panel_scales_y[[1]]$range$range,
                ggplot_build(FVaccRR_DHBtot.plot[[3]])$layout$panel_scales_y[[1]]$range$range)

FVaccRR_DHBtot.plot & 
  ylim(min(p_ranges_y), max(p_ranges_y))

AllFVacc_DHBpopulation.df <- rbind(
  data.frame(TFVacc_DHBpopulation.df, population="Total"),
  data.frame(MFVacc_DHBpopulation.df, population="Maori"),
  data.frame(NMFVacc_DHBpopulation.df, population="Non-Maori")
)

ggplot(subset(AllFVacc_DHBpopulation.df), aes(x=factor(AgeGroup, level= level_order), y = RelativeRisk , fill = population, group=population)) + 
  geom_col(position = "dodge") +
  #geom_errorbar(aes(ymin=RelativeRiskLwr, ymax=RelativeRiskUpr),position = position_dodge(width = 0.85), width = 0.25) +
  #guides(fill = 'none') +
  plot_annotation(title = "Fully Vaccinated Rate Ratio by Age Group & Ethnicity (HSU as baseline)") +
  labs(y= "Rate Ratio",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

```

```{r, eval=FALSE}

pdf(file="Fully Vaccinated Rate Ratio by Age Group & Ethnicity (HSU as baseline).pdf", width = 10, height = 10)

ggplot(subset(AllFVacc_DHBpopulation.df), aes(x=factor(AgeGroup, level= level_order), y = RelativeRisk, fill = population, group=population)) + 
  geom_col(position = position_dodge()) +
  #geom_errorbar(aes(ymin=RelativeRiskLwr, ymax=RelativeRiskUpr),position = position_dodge(width = 0.85), width = 0.5) +
  #guides(fill = 'none') +
  plot_annotation(title = "Fully Vaccinated Rate Ratio by Age Group & Ethnicity (HSU as baseline)") +
  labs(y= "Rate Ratio",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()

```


## Total Fully Vaccinated Rates by DHB

# separated DHB's by rate levels
```{r,fig.height= 10, fig.width= 10}
level_order <- c("5-11","12-17", "18-24", "25-29", "30-34", "35-39","40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90+")

# separated by rate levels

HSU_TFVacc_nontot_high15000.df <- HSU_TFVacc_nontot.df[HSU_TFVacc_nontot.df$DHB %in% c("Auckland", "Waitemata", "Counties Manukau", "Canterbury"),]
HSU_TFVacc_nontot_mid10000.df <- HSU_TFVacc_nontot.df[HSU_TFVacc_nontot.df$DHB %in% c("Bay of Plenty", "Waikato", "Capital and Coast", "Southern"),]
HSU_TFVacc_nontot_mid5000.df <- HSU_TFVacc_nontot.df[HSU_TFVacc_nontot.df$DHB %in% c("Northland", "MidCentral",  "Hawkes Bay", "Nelson Marlborough"),]
HSU_TFVacc_nontot_mid3500.df <- HSU_TFVacc_nontot.df[HSU_TFVacc_nontot.df$DHB %in% c("Lakes", "Taranaki", "South Canterbury", "Hutt Valley"),]
HSU_TFVacc_nontot_low2000.df <- HSU_TFVacc_nontot.df[HSU_TFVacc_nontot.df$DHB %in% c("West Coast", "Tairawhiti", "Whanganui", "Wairarapa"),]

ERP_TFVacc_nontot_high15000.df <- ERP_TFVacc_nontot.df[ERP_TFVacc_nontot.df$DHB %in% c("Auckland", "Waitemata", "Counties Manukau", "Canterbury"),]
ERP_TFVacc_nontot_mid10000.df <- ERP_TFVacc_nontot.df[ERP_TFVacc_nontot.df$DHB %in% c("Bay of Plenty", "Waikato", "Capital and Coast", "Southern"),]
ERP_TFVacc_nontot_mid5000.df <- ERP_TFVacc_nontot.df[ERP_TFVacc_nontot.df$DHB %in% c("Northland", "MidCentral",  "Hawkes Bay", "Nelson Marlborough"),]
ERP_TFVacc_nontot_mid3500.df <- ERP_TFVacc_nontot.df[ERP_TFVacc_nontot.df$DHB %in% c("Lakes", "Taranaki", "South Canterbury", "Hutt Valley"),]
ERP_TFVacc_nontot_low2000.df <- ERP_TFVacc_nontot.df[ERP_TFVacc_nontot.df$DHB %in% c("West Coast", "Tairawhiti", "Whanganui", "Wairarapa"),]

# plots for high range(approx 15,000)

HSUvsERP_TFVacc_high15000.df <- rbind(
  data.frame(HSU_TFVacc_nontot_high15000.df, population="HSU"),
  data.frame(ERP_TFVacc_nontot_high15000.df, population="ERP")
)

ggplot(subset(HSUvsERP_TFVacc_high15000.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Total Fully Vaccinated by Age Group & DHB (Rates approx <15,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

```

```{r, eval=FALSE}

#pdf(file="Total Fully Vaccinated by Age Group & DHB (Rates approx <15,000 per 100,000).pdf", width = 10, height = 10)


ggplot(subset(HSUvsERP_TFVacc_high15000.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Total Fully Vaccinated by Age Group & DHB (Rates approx <15,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))


dev.off()

```


```{r}


# plots for mid range(less than 10,000)

HSUvsERP_TFVacc_mid10000.df <- rbind(
  data.frame(HSU_TFVacc_nontot_mid10000.df, population="HSU"),
  data.frame(ERP_TFVacc_nontot_mid10000.df, population="ERP")
)

ggplot(subset(HSUvsERP_TFVacc_mid10000.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Total Fully Vaccinated by Age Group & DHB (Rates approx <10,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

```

```{r, eval=FALSE}


#pdf(file="Total Fully Vaccinated by Age Group & DHB (Rates approx <10,000 per 100,000).pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_TFVacc_mid10000.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Total Fully Vaccinated by Age Group & DHB (Rates approx <10,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()

```

```{r}


# plots for mid range(less than 5,000)

HSUvsERP_TFVacc_mid5000.df <- rbind(
  data.frame(HSU_TFVacc_nontot_mid5000.df, population="HSU"),
  data.frame(ERP_TFVacc_nontot_mid5000.df, population="ERP")
)

ggplot(subset(HSUvsERP_TFVacc_mid5000.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Total Fully Vaccinated by Age Group & DHB (Rates approx <5,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))
```

```{r, eval=FALSE}


#pdf(file="Total Fully Vaccinated by Age Group & DHB (Rates approx <5,000 per 100,000).pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_TFVacc_mid5000.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Total Fully Vaccinated by Age Group & DHB (Rates approx <5,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))


dev.off()

```

```{r}


# plots for mid range(less than 3500)

HSUvsERP_TFVacc_mid3500.df <- rbind(
  data.frame(HSU_TFVacc_nontot_mid3500.df, population="HSU"),
  data.frame(ERP_TFVacc_nontot_mid3500.df, population="ERP")
)

ggplot(subset(HSUvsERP_TFVacc_mid3500.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Total Fully Vaccinated by Age Group & DHB (Rates approx <3,500 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

```

```{r, eval=FALSE}

#pdf(file="Total Fully Vaccinated by Age Group & DHB (Rates approx <3,500 per 100,000).pdf", width = 10, height = 10)


ggplot(subset(HSUvsERP_TFVacc_mid3500.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Total Fully Vaccinated by Age Group & DHB (Rates approx <3,500 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()


```

```{r}
# plots for low range(less than 2500)

HSUvsERP_TFVacc_low2000.df <- rbind(
  data.frame(HSU_TFVacc_nontot_low2000.df, population="HSU"),
  data.frame(ERP_TFVacc_nontot_low2000.df, population="ERP")
)

ggplot(subset(HSUvsERP_TFVacc_low2000.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Total Fully Vaccinated by Age Group & DHB (Rates approx <2,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))
```

```{r, eval=FALSE}

#pdf(file="Total Fully Vaccinated by Age Group & DHB (Rates approx <2,000 per 100,000).pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_TFVacc_low2000.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Total Fully Vaccinated by Age Group & DHB (Rates approx <2,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()

```
## presenting lowest vs. highest
```{r, fig.height= 10, fig.width= 10}
# separated by rate levels

HSU_TFVacc_nontot_highest.df <- HSU_TFVacc_nontot.df[HSU_TFVacc_nontot.df$DHB %in% c("Counties Manukau"),]
HSU_TFVacc_nontot_lowest.df <- HSU_TFVacc_nontot.df[HSU_TFVacc_nontot.df$DHB %in% c("West Coast"),]

ERP_TFVacc_nontot_highest.df <- ERP_TFVacc_nontot.df[ERP_TFVacc_nontot.df$DHB %in% c("Counties Manukau"),]
ERP_TFVacc_nontot_lowest.df <- ERP_TFVacc_nontot.df[ERP_TFVacc_nontot.df$DHB %in% c("West Coast"),]



HSUvsERP_TFVacc_low.df <- rbind(
  data.frame(HSU_TFVacc_nontot_lowest.df, population="HSU"),
  data.frame(ERP_TFVacc_nontot_lowest.df, population="ERP")
)

ggplot(subset(HSUvsERP_TFVacc_low.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Total Fully Vaccinated by Age Group for West Coast DHB (Lowest Rates per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

```

```{r, eval=FALSE}

#pdf(file="Total Fully Vaccinated by Age Group & lowest DHB.pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_TFVacc_low.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Total Fully Vaccinated by Age Group for West Coast DHB (Lowest Rates per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()

```

```{r}
HSUvsERP_TFVacc_high.df <- rbind(
  data.frame(HSU_TFVacc_nontot_highest.df, population="HSU"),
  data.frame(ERP_TFVacc_nontot_highest.df, population="ERP")
)

ggplot(subset(HSUvsERP_TFVacc_high.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Total Fully Vaccinated by Age Group for Counties Manukau DHB (Highest Rates per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

```

```{r, eval=FALSE}
#pdf(file="Total Fully Vaccinated by Age Group & highest DHB.pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_TFVacc_high.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Total Fully Vaccinated by Age Group for Counties Manukau DHB (Highest Rates per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()

```

```{r}
## collating plot into one for differences

HSU_TFVacc_nontot_lowvshigh.df <- HSU_TFVacc_nontot.df[HSU_TFVacc_nontot.df$DHB %in% c("Counties Manukau","West Coast"),]
ERP_TFVacc_nontot_lowvshigh.df <- ERP_TFVacc_nontot.df[ERP_TFVacc_nontot.df$DHB %in% c("Counties Manukau","West Coast"),]


HSUvsERP_TFVacc_lowvshigh.df <- rbind(
  data.frame(HSU_TFVacc_nontot_lowvshigh.df, population="HSU"),
  data.frame(ERP_TFVacc_nontot_lowvshigh.df, population="ERP")
)

ggplot(subset(HSUvsERP_TFVacc_lowvshigh.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Total Fully Vaccinated by Age Group & DHB (Lowest vs. Highest rates per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

```

```{r, eval=FALSE}
#pdf(file="Total Fully Vaccinated by Age Group & highest vs. lowest DHB.pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_TFVacc_lowvshigh.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Total Fully Vaccinated by Age Group & DHB (Lowest vs. Highest rates per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()

```


#separating by DHB for Māori

```{r, fig.height= 10, fig.width= 10}
HSU_MFVacc_nontot_high15000.df <- HSU_MFVacc_nontot.df[HSU_MFVacc_nontot.df$DHB %in% c("Northland", "Waikato","Counties Manukau", "Bay of Plenty"),]
HSU_MFVacc_nontot_mid10000.df <- HSU_MFVacc_nontot.df[HSU_MFVacc_nontot.df$DHB %in% c("Waitemata", "Lakes","Tairawhiti", "Hawkes Bay"),]
HSU_MFVacc_nontot_mid1.df <- HSU_MFVacc_nontot.df[HSU_MFVacc_nontot.df$DHB %in% c("Canterbury", "Southern", "Capital and Coast", "Auckland"),]
HSU_MFVacc_nontot_mid2.df <- HSU_MFVacc_nontot.df[HSU_MFVacc_nontot.df$DHB %in% c("MidCentral", "Hutt Valley", "Taranaki", "Whanganui"),]

HSU_MFVacc_nontot_low.df <- HSU_MFVacc_nontot.df[HSU_MFVacc_nontot.df$DHB %in% c("South Canterbury", "West Coast", "Nelson Marlborough", "Wairarapa"),]


ERP_MFVacc_nontot_high15000.df <- ERP_MFVacc_nontot.df[ERP_MFVacc_nontot.df$DHB %in% c("Northland", "Waikato","Counties Manukau", "Bay of Plenty"),]
ERP_MFVacc_nontot_mid10000.df <- ERP_MFVacc_nontot.df[ERP_MFVacc_nontot.df$DHB %in% c("Waitemata", "Lakes","Tairawhiti", "Hawkes Bay"),]
ERP_MFVacc_nontot_mid1.df <- ERP_MFVacc_nontot.df[ERP_MFVacc_nontot.df$DHB %in% c("Canterbury", "Southern", "Capital and Coast", "Auckland"),]

ERP_MFVacc_nontot_mid2.df <- ERP_MFVacc_nontot.df[ERP_MFVacc_nontot.df$DHB %in% c("MidCentral", "Hutt Valley", "Taranaki", "Whanganui"),]
ERP_MFVacc_nontot_low.df <- ERP_MFVacc_nontot.df[ERP_MFVacc_nontot.df$DHB %in% c("South Canterbury", "West Coast", "Nelson Marlborough", "Wairarapa"),]

# plots for high range(approx 15000)
HSUvsERP_MFVacc_high15000.df <- rbind(
  data.frame(HSU_MFVacc_nontot_high15000.df, population="HSU"),
  data.frame(ERP_MFVacc_nontot_high15000.df, population="ERP")
)

ggplot(subset(HSUvsERP_MFVacc_high15000.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Maori Fully Vaccinated by Age Group & DHB (Rates approx <15,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

```

```{r, eval=FALSE}
#pdf(file="Maori Fully Vaccinated by Age Group & DHB (Rates approx <15,000 per 100,000).pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_MFVacc_high15000.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Maori Fully Vaccinated by Age Group & DHB (Rates approx <15,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()
```

```{r}
# plots for mid range(approx 10,000)

HSUvsERP_MFVacc_mid10000.df <- rbind(
  data.frame(HSU_MFVacc_nontot_mid10000.df, population="HSU"),
  data.frame(ERP_MFVacc_nontot_mid10000.df, population="ERP")
)

ggplot(subset(HSUvsERP_MFVacc_mid10000.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Maori Fully Vaccinated by Age Group & DHB (Rates approx <7,500 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

```

```{r, eval=FALSE}
#pdf(file="Maori Fully Vaccinated by Age Group & DHB (Rates approx <7,500 per 100,000)1.pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_MFVacc_mid10000.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Maori Fully Vaccinated by Age Group & DHB (Rates approx <7,500 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()
```

```{r}

# mid range
HSUvsERP_MFVacc_mid1.df <- rbind(
  data.frame(HSU_MFVacc_nontot_mid1.df, population="HSU"),
  data.frame(ERP_MFVacc_nontot_mid1.df, population="ERP")
)

ggplot(subset(HSUvsERP_MFVacc_mid1.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Maori Fully Vaccinated by Age Group & DHB (Rates approx <7,500 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

```

```{r, eval=FALSE}
#pdf(file="Maori Fully Vaccinated by Age Group & DHB (Rates approx <7,500 per 100,000)2.pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_MFVacc_mid1.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Maori Fully Vaccinated by Age Group & DHB (Rates approx <7,500 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()
```

```{r}
# Capital and Coast, Nelson Marlborough, West Coast, Canterbury, South Canterbury, Southern

HSUvsERP_MFVacc_mid2.df <- rbind(
  data.frame(HSU_MFVacc_nontot_mid2.df, population="HSU"),
  data.frame(ERP_MFVacc_nontot_mid2.df, population="ERP")
)

ggplot(subset(HSUvsERP_MFVacc_mid2.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Maori Fully Vaccinated by Age Group & DHB (Rates approx <5,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))
```

```{r, eval=FALSE}

#pdf(file="Maori Fully Vaccinated by Age Group & DHB (Rates approx <5,000 per 100,000).pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_MFVacc_mid2.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Maori Fully Vaccinated by Age Group & DHB (Rates approx <5,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()
```

```{r}

#low 
HSUvsERP_MFVacc_low.df <- rbind(
  data.frame(HSU_MFVacc_nontot_low.df, population="HSU"),
  data.frame(ERP_MFVacc_nontot_low.df, population="ERP")
)

ggplot(subset(HSUvsERP_MFVacc_low.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Maori Fully Vaccinated by Age Group & DHB (Rates approx <3,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))


```

```{r, eval=FALSE}
#pdf(file="Maori Fully Vaccinated by Age Group & DHB (Rates approx <3,000 per 100,000).pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_MFVacc_low.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Maori Fully Vaccinated by Age Group & DHB (Rates approx <3,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()

```


## presenting lowest vs. highest
```{r, fig.height= 10, fig.width= 10}
# separated by rate levels

HSU_MFVacc_nontot_highest.df <- HSU_MFVacc_nontot.df[HSU_MFVacc_nontot.df$DHB %in% c("Waikato"),]
HSU_MFVacc_nontot_lowest.df <- HSU_MFVacc_nontot.df[HSU_MFVacc_nontot.df$DHB %in% c("West Coast"),]

ERP_MFVacc_nontot_highest.df <- ERP_MFVacc_nontot.df[ERP_MFVacc_nontot.df$DHB %in% c("Waikato"),]
ERP_MFVacc_nontot_lowest.df <- ERP_MFVacc_nontot.df[ERP_MFVacc_nontot.df$DHB %in% c("West Coast"),]



HSUvsERP_MFVacc_low.df <- rbind(
  data.frame(HSU_MFVacc_nontot_lowest.df, population="HSU"),
  data.frame(ERP_MFVacc_nontot_lowest.df, population="ERP")
)

ggplot(subset(HSUvsERP_MFVacc_low.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Maori Fully Vaccinated by Age Group for West Coast DHB (Lowest Rates per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

```

```{r, eval=FALSE}

#pdf(file="Maori Fully Vaccinated by Age Group & lowest DHB.pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_MFVacc_low.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Maori Fully Vaccinated by Age Group for West Coast DHB (Lowest Rates per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()
```

```{r}

HSUvsERP_MFVacc_high.df <- rbind(
  data.frame(HSU_MFVacc_nontot_highest.df, population="HSU"),
  data.frame(ERP_MFVacc_nontot_highest.df, population="ERP")
)

ggplot(subset(HSUvsERP_MFVacc_high.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Maori Fully Vaccinated by Age Group for Waikato DHB (Highest Rates per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))
```

```{r, eval=FALSE}

#pdf(file="Maori Fully Vaccinated by Age Group & highest DHB.pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_MFVacc_high.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Maori Fully Vaccinated by Age Group for Waikato DHB (Highest Rates per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()
```

```{r}

## collating plot into one for differences

HSU_MFVacc_nontot_lowvshigh.df <- HSU_MFVacc_nontot.df[HSU_MFVacc_nontot.df$DHB %in% c("Waikato","West Coast"),]
ERP_MFVacc_nontot_lowvshigh.df <- ERP_MFVacc_nontot.df[ERP_MFVacc_nontot.df$DHB %in% c("Waikato","West Coast"),]


HSUvsERP_MFVacc_lowvshigh.df <- rbind(
  data.frame(HSU_MFVacc_nontot_lowvshigh.df, population="HSU"),
  data.frame(ERP_MFVacc_nontot_lowvshigh.df, population="ERP")
)

ggplot(subset(HSUvsERP_MFVacc_lowvshigh.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Maori Fully Vaccinated by Age Group & DHB (Lowest vs. Highest rates per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

```

```{r, eval=FALSE}
#pdf(file="Maori Fully Vaccinated by Age Group & highest vs. lowest DHB.pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_MFVacc_lowvshigh.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Maori Fully Vaccinated by Age Group & DHB (Lowest vs. Highest rates per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()

```



#separating by DHB for Non-Māori

```{r, fig.height= 10, fig.width= 10}

HSU_NMFVacc_nontot_high15000.df <- HSU_NMFVacc_nontot.df[HSU_NMFVacc_nontot.df$DHB %in% c("Auckland", "Waitemata", "Counties Manukau", "Canterbury"),]
HSU_NMFVacc_nontot_mid10000.df <- HSU_NMFVacc_nontot.df[HSU_NMFVacc_nontot.df$DHB %in% c("Bay of Plenty", "Waikato", "Capital and Coast", "Southern"),]
HSU_NMFVacc_nontot_mid1.df <- HSU_NMFVacc_nontot.df[HSU_NMFVacc_nontot.df$DHB %in% c("Northland", "MidCentral",  "Hawkes Bay", "Nelson Marlborough"),]
HSU_NMFVacc_nontot_mid2.df <- HSU_NMFVacc_nontot.df[HSU_NMFVacc_nontot.df$DHB %in% c("Lakes", "Taranaki", "South Canterbury", "Hutt Valley"),]
HSU_NMFVacc_nontot_low.df <- HSU_NMFVacc_nontot.df[HSU_NMFVacc_nontot.df$DHB %in% c("West Coast", "Tairawhiti", "Whanganui", "Wairarapa"),]

ERP_NMFVacc_nontot_high15000.df <- ERP_NMFVacc_nontot.df[ERP_NMFVacc_nontot.df$DHB %in% c("Auckland", "Waitemata", "Counties Manukau", "Canterbury"),]
ERP_NMFVacc_nontot_mid10000.df <- ERP_NMFVacc_nontot.df[ERP_NMFVacc_nontot.df$DHB %in% c("Bay of Plenty", "Waikato", "Capital and Coast", "Southern"),]
ERP_NMFVacc_nontot_mid1.df <- ERP_NMFVacc_nontot.df[ERP_TFVacc_nontot.df$DHB %in% c("Northland", "MidCentral",  "Hawkes Bay", "Nelson Marlborough"),]
ERP_NMFVacc_nontot_mid2.df <- ERP_NMFVacc_nontot.df[ERP_TFVacc_nontot.df$DHB %in% c("Lakes", "Taranaki", "South Canterbury", "Hutt Valley"),]
ERP_NMFVacc_nontot_low.df <- ERP_NMFVacc_nontot.df[ERP_TFVacc_nontot.df$DHB %in% c("West Coast", "Tairawhiti", "Whanganui", "Wairarapa"),]


# plots for high range(approx 15000)
HSUvsERP_NMFVacc_high15000.df <- rbind(
  data.frame(HSU_NMFVacc_nontot_high15000.df, population="HSU"),
  data.frame(ERP_NMFVacc_nontot_high15000.df, population="ERP")
)

ggplot(subset(HSUvsERP_NMFVacc_high15000.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Non-Maori Fully Vaccinated by Age Group & DHB (Rates approx <20,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))
```

```{r, eval=FALSE}

#pdf(file="Non-Maori Fully Vaccinated by Age Group & DHB (Rates approx <20,000 per 100,000).pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_NMFVacc_high15000.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Non-Maori Fully Vaccinated by Age Group & DHB (Rates approx <20,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()
```

```{r}

# plots for mid range(approx 10,000)

HSUvsERP_NMFVacc_mid10000.df <- rbind(
  data.frame(HSU_NMFVacc_nontot_mid10000.df, population="HSU"),
  data.frame(ERP_NMFVacc_nontot_mid10000.df, population="ERP")
)

ggplot(subset(HSUvsERP_NMFVacc_mid10000.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Non-Maori Fully Vaccinated by Age Group & DHB (Rates approx <10,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))
```

```{r, eval=FALSE}

#pdf(file="Non-Maori Fully Vaccinated by Age Group & DHB (Rates approx <10,000 per 100,000).pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_NMFVacc_mid10000.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Non-Maori Fully Vaccinated by Age Group & DHB (Rates approx <10,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()
```

```{r}

# mid range
HSUvsERP_NMFVacc_mid1.df <- rbind(
  data.frame(HSU_NMFVacc_nontot_mid1.df, population="HSU"),
  data.frame(ERP_NMFVacc_nontot_mid1.df, population="ERP")
)

ggplot(subset(HSUvsERP_NMFVacc_mid1.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Non-Maori Fully Vaccinated by Age Group & DHB (Rates approx <5,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))
```

```{r, eval=FALSE}

#pdf(file="Non-Maori Fully Vaccinated by Age Group & DHB (Rates approx <5,000 per 100,000)1.pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_NMFVacc_mid1.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Non-Maori Fully Vaccinated by Age Group & DHB (Rates approx <5,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()
```

```{r}
# Capital and Coast, Nelson Marlborough, West Coast, Canterbury, South Canterbury, Southern

HSUvsERP_NMFVacc_mid2.df <- rbind(
  data.frame(HSU_NMFVacc_nontot_mid2.df, population="HSU"),
  data.frame(ERP_NMFVacc_nontot_mid2.df, population="ERP")
)

ggplot(subset(HSUvsERP_NMFVacc_mid2.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Non-Maori Fully Vaccinated by Age Group & DHB (Rates approx <5,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))
```

```{r, eval=FALSE}
#pdf(file="Non-Maori Fully Vaccinated by Age Group & DHB (Rates approx <5,000 per 100,000)2.pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_NMFVacc_mid2.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Non-Maori Fully Vaccinated by Age Group & DHB (Rates approx <5,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()
```

```{r}

#low 
HSUvsERP_NMFVacc_low.df <- rbind(
  data.frame(HSU_NMFVacc_nontot_low.df, population="HSU"),
  data.frame(ERP_NMFVacc_nontot_low.df, population="ERP")
)

ggplot(subset(HSUvsERP_NMFVacc_low.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Non-Maori Fully Vaccinated by Age Group & DHB (Rates approx <2,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))
```

```{r, eval=FALSE}
#pdf(file="Non-Maori Fully Vaccinated by Age Group & DHB (Rates approx <2,000 per 100,000).pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_NMFVacc_low.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Non-Maori Fully Vaccinated by Age Group & DHB (Rates approx <2,000 per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()

```


## presenting lowest vs. highest between Māori and non-maori
```{r, fig.height= 10, fig.width= 10}
# separated by rate levels

HSU_NMFVacc_nontot_highestdiff.df <- HSU_NMFVacc_nontot.df[HSU_NMFVacc_nontot.df$DHB %in% c("Nelson Marlborough"),]

ERP_NMFVacc_nontot_highestdiff.df <- ERP_NMFVacc_nontot.df[ERP_NMFVacc_nontot.df$DHB %in% c("Nelson Marlborough"),]



HSUvsERP_NMFVacc_highestdiff.df <- rbind(
  data.frame(HSU_NMFVacc_nontot_highestdiff.df, population="HSU"),
  data.frame(ERP_NMFVacc_nontot_highestdiff.df, population="ERP")
)

ggplot(subset(HSUvsERP_NMFVacc_highestdiff.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Non-Maori Fully Vaccinated by Age Group for Nelson Marlborough DHB (Rates per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))
```


```{r, eval=FALSE}
#pdf(file="Non-Maori Fully Vaccinated by Age Group & highest diff DHB.pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_NMFVacc_highestdiff.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Non-Maori Fully Vaccinated by Age Group for Nelson Marlborough DHB (Rates per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()
```

```{r}


HSU_MFVacc_nontot_highestdiff.df <- HSU_MFVacc_nontot.df[HSU_MFVacc_nontot.df$DHB %in% c("Nelson Marlborough"),]

ERP_MFVacc_nontot_highestdiff.df <- ERP_MFVacc_nontot.df[ERP_MFVacc_nontot.df$DHB %in% c("Nelson Marlborough"),]


HSUvsERP_MFVacc_highestdiff.df <- rbind(
  data.frame(HSU_MFVacc_nontot_highestdiff.df, population="HSU"),
  data.frame(ERP_MFVacc_nontot_highestdiff.df, population="ERP")
)

ggplot(subset(HSUvsERP_MFVacc_highestdiff.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Maori Fully Vaccinated by Age Group for Nelson Marlborough DHB (Rates per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))
```

```{r, eval=FALSE}
#pdf(file="Maori Fully Vaccinated by Age Group & highest diff DHB.pdf", width = 10, height = 10)

ggplot(subset(HSUvsERP_MFVacc_highestdiff.df), aes(x=factor(AgeGroup, level= level_order), y = RateMult, fill = population, group=population)) +
  geom_col(position = position_dodge()) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5,hjust=1)) +
  geom_errorbar(aes(ymin=Rate_Gamma1Lwr, ymax=Rate_Gamma1Upr), position = position_dodge(width = 0.85), width = 0.5) +
  facet_wrap(~DHB) +
  plot_annotation(title = "Maori Fully Vaccinated by Age Group for Nelson Marlborough DHB (Rates per 100,000)") +
  labs(y= "Rate per 100,000",
       x= "Age Groups") &
  theme(plot.title = element_text(hjust = 0.5))

dev.off()





```
